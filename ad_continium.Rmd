---
title: "AD continuum"
author: "Alejandro Cisterna"
date: "June 15, 2022"
output:
  html_document:
    code_folding: hide
    theme: spacelab
    highlight: kate
    df_print: paged
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

knitr::opts_chunk$set(echo = TRUE , warning= FALSE, message=FALSE, fig.width=12, fig.height=8)

library(dplyr)
library (tibble)
library (ggplot2)
library (pROC)
library (reshape)
library(readr)
library(readxl)
library(doParallel)
library(stringr)
library(plyr)
library(tidyverse)
library(data.table)
library(glmnet)
library(InformationValue)
library(entropy)
library(ggcorrplot)
library(lares)
library(corrr)
library(ggpubr)
library(kableExtra)
library(scales)
library(beeswarm)
library(ggbeeswarm)
library(enrichR)
library(biomaRt)
library(kit)
library(reshape2)
library(gridExtra)
library(grid)
library(corrplot)
library("PerformanceAnalytics")
library(pROC)
library(MLeval)
library(caret)
library(plotROC)
library(RColorBrewer)
library(ggrepel)
library(ggvenn)
library(PRROC)
library(GeneOverlap)
```

# AD continuum


## Scale two sets function


```{r}
i = 1

scaletwosets = function(trainingreference, dftoscale){
  
  # As data frame
  trainingreference = as.data.frame(trainingreference)
  dftoscale = as.data.frame(dftoscale)
  
  
  columnscommon = which(colnames(trainingreference) %in% colnames(dftoscale))


  trainingreference = trainingreference[,columnscommon]
  
  # Make data frame with the same number of rows and columns
  dfscalated = data.frame(matrix(0, nrow = nrow(dftoscale), ncol = ncol(dftoscale),
                              dimnames = list(NULL, colnames(dftoscale))) )

  
      for(i in 1:length(colnames(trainingreference))){
        
      # Compute max and min for each feature in the training reference
      df1range = NULL
      df1range = range(trainingreference[,i])
      df1rangemin = df1range[1]
      df1rangemax = df1range[2]
      
      # Scale to this min and max the values in the dftoscale
      vec_range <- rescale(dftoscale[,i], to = c(df1rangemin, df1rangemax))
      dfscalated[,i] = vec_range
      
    }

  return(dfscalated)

}

```


## 220 genes

```{r}

genestodoml220 = fread("220genes.csv")

genestodoml220 = genestodoml220$ENSG

genestodoml = genestodoml220

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]



# Select only genes
x_train <- train[,-1]

# Compute Z score



modelo_means <- as.data.frame(lapply(x_train, mean))
modelo_sd <- as.data.frame(lapply(x_train, sd))



```


 ### Preclinicals all


```{r}

genestodoml = genestodoml220

genestodoml = c(genestodoml, "Status")

 
# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase

trainconpred = train



# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]



# Select only genes
x_train <- train[,-1]

# Compute Z score
x_train <- as.data.frame(lapply(x_train, function(x) (x - mean(x))/sd(x) ))
x_train <- as.matrix(x_train )

# Code status
numeros = as.numeric(train$Status)
y_train <-replace(numeros, numeros == 2,0)


y_train_220 = y_train 

# Set seed
set.seed(123)

# Train ridge
cv_error <- cv.glmnet(
  x      = x_train,
  y      = factor(y_train),
  alpha  = 0,
  nfolds = 5, #
  type.measure = "mse",
  standardize  = F,
  family = "binomial",
  intercept = F
)



# Best model lambda
modelo <- glmnet(
  x           = x_train,
  y           = y_train,
  alpha       = 0,
  lambda      = cv_error$lambda.min,
  standardize = F,
  family = "binomial",
  intercept = F
)


# Training predictions
# ==============================================================================
predicciones_train_220 <- predict(modelo, newx = x_train, type = "response", standardize = F)




genestodoml = genestodoml220
genestodoml = c(genestodoml, "Status")
# Load Matrix
test = readRDS("rlogmatrix_allpsold38qcp_notion")


tocorrelationtest = test[,c(1,2,3,4,6)]


# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]




# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))
x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 1,0)
y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_220 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_220 = predicciones_test





# Model220 roc comes from above code (220 genes model)

model220rocte = as.data.frame(y_test_220)
model220rocte$predictor = predicciones_test_220
model220rocte$model = "220 genes preclinical AD (AUC = 0.97)"


names(model220rocte) = c("status", "predictor", "Classifier")



model220roctr = as.data.frame(y_train_220)
model220roctr$predictor = predicciones_train_220
model220roctr$model = "220 genes preclinical AD (AUC = 0.97)"

names(model220roctr) = c("status", "predictor", "Classifier")



model220rocadcontinuum = rbind(model220rocte,model220roctr)

# Extract control samples

controlsforspe = model220rocadcontinuum[model220rocadcontinuum$status == 0,]

  # Add this dataset to the final

    
    
```


### cdr 0.5 k99


```{r}

genestodoml = genestodoml220

genestodoml = c(genestodoml, "Status")

 
# Load Matrix
test = readRDS("matrix_K99rlogcdr05status")

test = as.data.frame(test)

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"



genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)


test = readRDS("matrix_K99rlogcdr05status")

test = as.data.frame(test)

commontest = colnames(test) %in% genestodoml
test = test[,commontest]


# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))

 # add gene name from cdr05
x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))




x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 2,0)
#y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_220_cdr05k99 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_220_cdr05k99 = predicciones_test




# Model220 roc comes from above code (220 genes model)

model220allcdr05k99 = as.data.frame(y_test_220_cdr05k99)
model220allcdr05k99$predictor = predicciones_test_220_cdr05k99
model220allcdr05k99$model = "220 genes prodromal AD (AUC = 0.98)"


names(model220allcdr05k99) = c("status", "predictor", "Classifier")


model220allcdr05k99 = model220allcdr05k99[model220allcdr05k99$status == 1,]



model220allcdr05k99 = rbind(model220allcdr05k99,controlsforspe)

    model220allcdr05k99$Classifier = "220 genes prodromal AD (AUC = 0.98)"
    
```


### AD CDR 0.5 EXPANSION values


Scale CDR 0.5 individuals


```{r}

genestodoml = genestodoml220

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]

# Select only genes
x_train <- train[,-1]




test = readRDS("rlogmatrix_allCDR05old38_notion")

genestodoml = c(genestodoml, "Status")

test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <- test[,-1]


cdr05scalated = scaletwosets(x_train, x_test)



```

```{r}

genestodoml = c(genestodoml, "Status")

# Load Matrix
test = readRDS("rlogmatrix_allCDR05old38_notion")


genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"


genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)



test = readRDS("rlogmatrix_allCDR05old38_notion")
test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <-cdr05scalated




modelo_meansftdp = modelo_means


which(colnames(modelo_meansftdp) %in% genesnoaparecen)  

modelo_meansftd = modelo_meansftdp[,-192]

modelo_sdftdp = modelo_sd

modelo_sdftdpd = modelo_sdftdp[,-192]


x_testprueba = x_test[]-modelo_meansftd[col(x_test[])]

x_testpruebafinal = x_testprueba[]/modelo_sdftdpd[col(x_testprueba[])]

x_test = x_testpruebafinal

x_test = as.data.frame(x_test)

 # add gene name from cdr05
x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))

x_test <- as.matrix(x_test )


protoeatmap = as.data.frame(x_test)


# Code status
numeros = as.numeric(test$Status)
 y_test <-replace(numeros, numeros == 2,0)

y_test_cdr5exp =  y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F) 
 
 predicciones_test_cdr5exp = predicciones_test
 

 
 
model220cdr5exp = as.data.frame(y_test_cdr5exp)
model220cdr5exp$predictor = predicciones_test_cdr5exp
model220cdr5exp$model = "220 genes prodromal AD (AUC = 0.98)"


names(model220cdr5exp) = c("status", "predictor", "Classifier")



model220allcdr05roc = rbind(model220allcdr05k99,model220cdr5exp)

```



### cdr 1 k99 (Esquema cdr0.5)



```{r}

genestodoml = genestodoml220

genestodoml = c(genestodoml, "Status")

 
# Load Matrix
test = readRDS("matrix_K99rlogcdr1status")

test = as.data.frame(test)

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"



genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)


test = readRDS("matrix_K99rlogcdr1status")

test = as.data.frame(test)

commontest = colnames(test) %in% genestodoml
test = test[,commontest]


# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))

 # add gene name from cdr05
x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))




x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 2,0)
#y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_220_cdr1k99 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_220_cdr1k99 = predicciones_test




# Model220 roc comes from above code (220 genes model)

model220allcdr1k99 = as.data.frame(y_test_220_cdr1k99)
model220allcdr1k99$predictor = predicciones_test_220_cdr1k99
model220allcdr1k99$model = "220 genes clinical AD (AUC = 0.96)"


names(model220allcdr1k99) = c("status", "predictor", "Classifier")


model220allcdr1k99 = model220allcdr1k99[model220allcdr1k99$status == 1,]



model220allcdr1k99 = rbind(model220allcdr1k99,controlsforspe)

model220allcdr1k99$Classifier = "220 genes clinical AD (AUC = 0.96)"
    
```




### AD CDR 1 EXPANSION values


Scale CDR 1 individuals

```{r}

genestodoml = genestodoml220

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]

# Select only genes
x_train <- train[,-1]




test = readRDS("rlogmatrix_allCDR1old38notion")

genestodoml = c(genestodoml, "Status")

test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <- test[,-1]


cdr1scalated = scaletwosets(x_train, x_test)



```




```{r}

test = readRDS("rlogmatrix_allCDR1old38notion")
test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <-cdr1scalated




x_testprueba = x_test[]-modelo_means[col(x_test[])]

x_testpruebafinal = x_testprueba[]/modelo_sd[col(x_testprueba[])]

x_test = x_testpruebafinal

x_test = as.data.frame(x_test)



# add gene name from cdr05
#x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen) )
x_test <- as.matrix(x_test )


clinictoeatmap = as.data.frame(x_test)

# Code status
numeros = as.numeric(test$Status)
 y_test <-replace(numeros, numeros == 2,0)


 y_test_cdr1exp = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F) 
 
 
 
  predicciones_test_cdr1exp = predicciones_test
 

 
 
model220cdr1exp = as.data.frame(y_test_cdr1exp)
model220cdr1exp$predictor = predicciones_test_cdr1exp
model220cdr1exp$model = "220 genes clinical AD (AUC = 0.96)"


names(model220cdr1exp) = c("status", "predictor", "Classifier")


model220allcdr1roc = rbind(model220allcdr1k99,model220cdr1exp)

```

### Figure roc ad conti


```{r}


model220adcontroc = rbind(model220rocadcontinuum, model220allcdr05roc)
 
model220adcontroc = rbind(model220adcontroc, model220allcdr1roc)
  

model220adcontroc$Classifier = as.factor(model220adcontroc$Classifier)
 
  model220adcontroc$Classifier <- factor(model220adcontroc$Classifier, levels = c("220 genes preclinical AD (AUC = 0.97)","220 genes prodromal AD (AUC = 0.98)","220 genes clinical AD (AUC = 0.96)"))
 

colors =c("#B2DF8A", "#9A031E", "#A1A7B8")
colors<-setNames(colors[1:nlevels(model220adcontroc$Classifier)], levels(model220adcontroc$Classifier))



## draw plots
basicplot <- ggplot(model220adcontroc, aes(d = status, m = predictor, color = Classifier)) + geom_roc(n.cuts = 0) +   style_roc(theme = theme_bw, xlab = "1-Specificity", ylab = "Sensitivity") + geom_abline(slope = 1, intercept = 0, lty = 2, colour = 'black') + 
    scale_colour_manual(values=colors) 

## calculate auc
# De aqui es de donde coges el AUC para cada uno
calc_auc(basicplot)

basicplot

  ggsave(filename = "roccurvesadcontinuum.png",
        plot = basicplot,
        device = "png",
        width =10,
        height = 8,
        dpi = 600)
 
```




## 40 genes



```{r}

genestodoml40 = fread("40genes.csv")

genestodoml40 = genestodoml40[-1,1]
genestodoml40 = genestodoml40$V1

genestodoml = genestodoml40

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]



# Select only genes
x_train <- train[,-1]

# Compute Z score



modelo_means <- as.data.frame(lapply(x_train, mean))
modelo_sd <- as.data.frame(lapply(x_train, sd))



```


```{r}

genestodoml = genestodoml40

genestodoml = c(genestodoml40, "Status")

 
# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase

trainconpred = train



# Select features
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]



# Select only genes
x_train <- train[,-1]

# Compute Z score
x_train <- as.data.frame(lapply(x_train, function(x) (x - mean(x))/sd(x) ))
x_train <- as.matrix(x_train)

# Code status
numeros = as.numeric(train$Status)
y_train <-replace(numeros, numeros == 2,0)


y_train_40 = y_train 

# Set seed
set.seed(123)

# Train ridge
cv_error <- cv.glmnet(
  x      = x_train,
  y      = factor(y_train),
  alpha  = 0,
  nfolds = 5, #
  type.measure = "mse",
  standardize  = F,
  family = "binomial",
  intercept = F
)



# Best model lambda
modelo <- glmnet(
  x           = x_train,
  y           = y_train,
  alpha       = 0,
  lambda      = cv_error$lambda.min,
  standardize = F,
  family = "binomial",
  intercept = F
)


# Training predictions
# ==============================================================================
predicciones_train_40 <- predict(modelo, newx = x_train, type = "response", standardize = F)




genestodoml = genestodoml40
genestodoml = c(genestodoml, "Status")
# Load Matrix
test = readRDS("rlogmatrix_allpsold38qcp_notion")


tocorrelationtest = test[,c(1,2,3,4,6)]


# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]




# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))
x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 1,0)
y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_40 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_40 = predicciones_test





# Model220 roc comes from above code (220 genes model)

model40rocte = as.data.frame(y_test_40)
model40rocte$predictor = predicciones_test_40
model40rocte$model = "40 genes preclinical AD (AUC = 0.96)"


names(model40rocte) = c("status", "predictor", "Classifier")



model40roctr = as.data.frame(y_train_40)
model40roctr$predictor = predicciones_train_40
model40roctr$model = "40 genes preclinical AD (AUC = 0.96)"

names(model40roctr) = c("status", "predictor", "Classifier")



model40rocadcontinuum = rbind(model40rocte,model40roctr)

# Extract control samples

controlsforspe = model40rocadcontinuum[model40rocadcontinuum$status == 0,]

  # Add this dataset to the final

    
    
```




### cdr 0.5 k99


```{r}

genestodoml = genestodoml40

 genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"



genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"

genestodoml = c(genestodoml, "Status")



# Load Matrix
test = readRDS("matrix_K99rlogcdr05status")

test = as.data.frame(test)

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"



genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)


test = readRDS("matrix_K99rlogcdr05status")

test = as.data.frame(test)

commontest = colnames(test) %in% genestodoml
test = test[,commontest]


# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))






x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 2,0)
#y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_40_cdr05k99 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_40_cdr05k99 = predicciones_test




# Model40 roc comes from above code (40 genes model)

model40allcdr05k99 = as.data.frame(y_test_40_cdr05k99)
model40allcdr05k99$predictor = predicciones_test_40_cdr05k99
model40allcdr05k99$model = "40 genes prodromal AD (AUC = 0.93)"


names(model40allcdr05k99) = c("status", "predictor", "Classifier")


model40allcdr05k99 = model40allcdr05k99[model40allcdr05k99$status == 1,]



model40allcdr05k99 = rbind(model40allcdr05k99,controlsforspe)

    model40allcdr05k99$Classifier = "40 genes prodromal AD (AUC = 0.93)"
    
```


### AD CDR 0.5 EXPANSION values


Scale CDR 0.5 individuals


```{r}

genestodoml = genestodoml40

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]

# Select only genes
x_train <- train[,-1]




test = readRDS("rlogmatrix_allCDR05old38_notion")

genestodoml = c(genestodoml, "Status")

test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <- test[,-1]


cdr05scalated = scaletwosets(x_train, x_test)



```

```{r}

genestodoml = c(genestodoml, "Status")

# Load Matrix
test = readRDS("rlogmatrix_allCDR05old38_notion")


genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"


genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)



test = readRDS("rlogmatrix_allCDR05old38_notion")
test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <-cdr05scalated




modelo_meansftdp = modelo_means


which(colnames(modelo_meansftdp) %in% genesnoaparecen)  

# Aqui - el que no es gen
modelo_meansftd = modelo_meansftdp[,]

modelo_sdftdp = modelo_sd

modelo_sdftdpd = modelo_sdftdp[,]


x_testprueba = x_test[]-modelo_meansftd[col(x_test[])]

x_testpruebafinal = x_testprueba[]/modelo_sdftdpd[col(x_testprueba[])]

x_test = x_testpruebafinal

x_test = as.data.frame(x_test)

 # add gene name from cdr05
#x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))

x_test <- as.matrix(x_test )





# Code status
numeros = as.numeric(test$Status)
 y_test <-replace(numeros, numeros == 2,0)

y_test_cdr5exp =  y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F) 
 
 predicciones_test_cdr5exp = predicciones_test
 

 
 
model40cdr5exp = as.data.frame(y_test_cdr5exp)
model40cdr5exp$predictor = predicciones_test_cdr5exp
model40cdr5exp$model = "40 genes prodromal AD (AUC = 0.93)"


names(model40cdr5exp) = c("status", "predictor", "Classifier")



model40allcdr05roc = rbind(model40allcdr05k99,model40cdr5exp)

```



### cdr 1 k99 (Esquema cdr0.5)



```{r}

genestodoml = genestodoml40

genestodoml = c(genestodoml, "Status")

 
# Load Matrix
test = readRDS("matrix_K99rlogcdr1status")

test = as.data.frame(test)

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"



genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)


test = readRDS("matrix_K99rlogcdr1status")

test = as.data.frame(test)

commontest = colnames(test) %in% genestodoml
test = test[,commontest]


# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))

 # add gene name from cdr05
#x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))




x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 2,0)
#y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_40_cdr1k99 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_40_cdr1k99 = predicciones_test




# Model40 roc comes from above code (40 genes model)

model40allcdr1k99 = as.data.frame(y_test_40_cdr1k99)
model40allcdr1k99$predictor = predicciones_test_40_cdr1k99
model40allcdr1k99$model = "40 genes clinical AD (AUC = 0.91)"


names(model40allcdr1k99) = c("status", "predictor", "Classifier")


model40allcdr1k99 = model40allcdr1k99[model40allcdr1k99$status == 1,]



model40allcdr1k99 = rbind(model40allcdr1k99,controlsforspe)

model40allcdr1k99$Classifier = "40 genes clinical AD (AUC = 0.91)"
    
```




### AD CDR 1 EXPANSION values


Scale CDR 1 individuals

```{r}

genestodoml = genestodoml40

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]

# Select only genes
x_train <- train[,-1]




test = readRDS("rlogmatrix_allCDR1old38notion")

genestodoml = c(genestodoml, "Status")

test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <- test[,-1]


cdr1scalated = scaletwosets(x_train, x_test)



```




```{r}

test = readRDS("rlogmatrix_allCDR1old38notion")
test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <-cdr1scalated




x_testprueba = x_test[]-modelo_means[col(x_test[])]

x_testpruebafinal = x_testprueba[]/modelo_sd[col(x_testprueba[])]

x_test = x_testpruebafinal

x_test = as.data.frame(x_test)



# add gene name from cdr05
#x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen) )
x_test <- as.matrix(x_test )


clinictoeatmap = as.data.frame(x_test)

# Code status
numeros = as.numeric(test$Status)
 y_test <-replace(numeros, numeros == 2,0)


 y_test_cdr1exp = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F) 
 
 
 
  predicciones_test_cdr1exp = predicciones_test
 

 
 
model40cdr1exp = as.data.frame(y_test_cdr1exp)
model40cdr1exp$predictor = predicciones_test_cdr1exp
model40cdr1exp$model = "40 genes clinical AD (AUC = 0.91)"


names(model40cdr1exp) = c("status", "predictor", "Classifier")


model40allcdr1roc = rbind(model40allcdr1k99,model40cdr1exp)

```




### Figure roc ad conti


```{r}


model40adcontroc = rbind(model40rocadcontinuum, model40allcdr05roc)
 
model40adcontroc = rbind(model40adcontroc, model40allcdr1roc)
  

model40adcontroc$Classifier = as.factor(model40adcontroc$Classifier)
 
  model40adcontroc$Classifier <- factor(model40adcontroc$Classifier, levels = c("40 genes preclinical AD (AUC = 0.96)","40 genes prodromal AD (AUC = 0.93)","40 genes clinical AD (AUC = 0.91)"))
 

colors =c("#B2DF8A", "#9A031E", "#A1A7B8")
colors<-setNames(colors[1:nlevels(model40adcontroc$Classifier)], levels(model40adcontroc$Classifier))



## draw plots
basicplot <- ggplot(model40adcontroc, aes(d = status, m = predictor, color = Classifier)) + geom_roc(n.cuts = 0) +   style_roc(theme = theme_bw, xlab = "1-Specificity", ylab = "Sensitivity") + geom_abline(slope = 1, intercept = 0, lty = 2, colour = 'black') + 
    scale_colour_manual(values=colors) 

## calculate auc
# De aqui es de donde coges el AUC para cada uno
calc_auc(basicplot)

basicplot

  ggsave(filename = "roccurvesadcontinuum.png",
        plot = basicplot,
        device = "png",
        width =10,
        height = 8,
        dpi = 600)
 
```
## 90 genes



```{r}

genestodoml90 = fread("90genes.csv")

genestodoml90 = genestodoml90[-1,1]
genestodoml90 = genestodoml90$V1

genestodoml = genestodoml90

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]



# Select only genes
x_train <- train[,-1]

# Compute Z score



modelo_means <- as.data.frame(lapply(x_train, mean))
modelo_sd <- as.data.frame(lapply(x_train, sd))



```


```{r}

genestodoml = genestodoml90

genestodoml = c(genestodoml90, "Status")

 
# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase

trainconpred = train



# Select features
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]



# Select only genes
x_train <- train[,-1]

# Compute Z score
x_train <- as.data.frame(lapply(x_train, function(x) (x - mean(x))/sd(x) ))
x_train <- as.matrix(x_train)

# Code status
numeros = as.numeric(train$Status)
y_train <-replace(numeros, numeros == 2,0)


y_train_90 = y_train 

# Set seed
set.seed(123)

# Train ridge
cv_error <- cv.glmnet(
  x      = x_train,
  y      = factor(y_train),
  alpha  = 0,
  nfolds = 5, #
  type.measure = "mse",
  standardize  = F,
  family = "binomial",
  intercept = F
)



# Best model lambda
modelo <- glmnet(
  x           = x_train,
  y           = y_train,
  alpha       = 0,
  lambda      = cv_error$lambda.min,
  standardize = F,
  family = "binomial",
  intercept = F
)


# Training predictions
# ==============================================================================
predicciones_train_90 <- predict(modelo, newx = x_train, type = "response", standardize = F)




genestodoml = genestodoml90
genestodoml = c(genestodoml, "Status")
# Load Matrix
test = readRDS("rlogmatrix_allpsold38qcp_notion")


tocorrelationtest = test[,c(1,2,3,4,6)]


# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]




# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))
x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 1,0)
y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_90 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_90 = predicciones_test





# Model220 roc comes from above code (220 genes model)

model90rocte = as.data.frame(y_test_90)
model90rocte$predictor = predicciones_test_90
model90rocte$model = "90 genes preclinical AD (AUC = 0.96)"


names(model90rocte) = c("status", "predictor", "Classifier")



model90roctr = as.data.frame(y_train_90)
model90roctr$predictor = predicciones_train_90
model90roctr$model = "90 genes preclinical AD (AUC = 0.96)"

names(model90roctr) = c("status", "predictor", "Classifier")



model90rocadcontinuum = rbind(model90rocte,model90roctr)

# Extract control samples

controlsforspe = model90rocadcontinuum[model90rocadcontinuum$status == 0,]

  # Add this dataset to the final

    
    
```




### cdr 0.5 k99


```{r}

genestodoml = genestodoml90

 genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"



genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"

genestodoml = c(genestodoml, "Status")



# Load Matrix
test = readRDS("matrix_K99rlogcdr05status")

test = as.data.frame(test)

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"



genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)


test = readRDS("matrix_K99rlogcdr05status")

test = as.data.frame(test)

commontest = colnames(test) %in% genestodoml
test = test[,commontest]


# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))

 # add gene name from cdr05
x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))




x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 2,0)
#y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_90_cdr05k99 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_90_cdr05k99 = predicciones_test




# Model90 roc comes from above code (90 genes model)

model90allcdr05k99 = as.data.frame(y_test_90_cdr05k99)
model90allcdr05k99$predictor = predicciones_test_90_cdr05k99
model90allcdr05k99$model = "90 genes prodromal AD (AUC = 0.95)"


names(model90allcdr05k99) = c("status", "predictor", "Classifier")


model90allcdr05k99 = model90allcdr05k99[model90allcdr05k99$status == 1,]



model90allcdr05k99 = rbind(model90allcdr05k99,controlsforspe)

    model90allcdr05k99$Classifier = "90 genes prodromal AD (AUC = 0.95)"
    
```


### AD CDR 0.5 EXPANSION values


Scale CDR 0.5 individuals


```{r}

genestodoml = genestodoml90

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]

# Select only genes
x_train <- train[,-1]




test = readRDS("rlogmatrix_allCDR05old38_notion")

genestodoml = c(genestodoml, "Status")

test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <- test[,-1]


cdr05scalated = scaletwosets(x_train, x_test)



```

```{r}

genestodoml = c(genestodoml, "Status")

# Load Matrix
test = readRDS("rlogmatrix_allCDR05old38_notion")


genesgenestodoml = as.data.frame(genestodoml)
colnames(genesgenestodoml) = "gene"

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"


genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)



test = readRDS("rlogmatrix_allCDR05old38_notion")
test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <-cdr05scalated




modelo_meansftdp = modelo_means


which(colnames(modelo_meansftdp) %in% genesnoaparecen)  

# Aqui - el que no es gen
modelo_meansftd = modelo_meansftdp[,]

modelo_sdftdp = modelo_sd

modelo_sdftdpd = modelo_sdftdp[,]


x_testprueba = x_test[]-modelo_meansftd[col(x_test[])]

x_testpruebafinal = x_testprueba[]/modelo_sdftdpd[col(x_testprueba[])]

x_test = x_testpruebafinal

x_test = as.data.frame(x_test)

 # add gene name from cdr05
#x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))

x_test <- as.matrix(x_test )





# Code status
numeros = as.numeric(test$Status)
 y_test <-replace(numeros, numeros == 2,0)

y_test_cdr5exp =  y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F) 
 
 predicciones_test_cdr5exp = predicciones_test
 

 
 
model90cdr5exp = as.data.frame(y_test_cdr5exp)
model90cdr5exp$predictor = predicciones_test_cdr5exp
model90cdr5exp$model = "90 genes prodromal AD (AUC = 0.95)"


names(model90cdr5exp) = c("status", "predictor", "Classifier")



model90allcdr05roc = rbind(model90allcdr05k99,model90cdr5exp)

```



### cdr 1 k99 (Esquema cdr0.5)



```{r}

genestodoml = genestodoml90

genestodoml = c(genestodoml, "Status")

 
# Load Matrix
test = readRDS("matrix_K99rlogcdr1status")

test = as.data.frame(test)

# Select features
commontest = colnames(test) %in% genestodoml
test = test[,commontest]

nombrestest = as.data.frame(colnames(test))
colnames(nombrestest) = "gene"



genesnoaparecen = anti_join(genesgenestodoml,nombrestest)
genesnoaparecen = as.character(genesnoaparecen$gene)


test = readRDS("matrix_K99rlogcdr1status")

test = as.data.frame(test)

commontest = colnames(test) %in% genestodoml
test = test[,commontest]


# Select only genes
x_test <- test[,-1]

# Compute Z score
x_test <- as.data.frame(lapply(x_test, function(x) (x - mean(x))/sd(x) ))

 # add gene name from cdr05
x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen))




x_test <- as.matrix(x_test )

# Code status
numeros = as.numeric(test$Status)
y_test <-replace(numeros, numeros == 2,0)
#y_test <-replace(y_test, y_test == 2,1)
# y_test <-replace(numeros, numeros == 1,0)
# y_test <-replace(y_test, y_test == 2,1)


y_test_90_cdr1k99 = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F)

predicciones_test_90_cdr1k99 = predicciones_test




# Model90 roc comes from above code (90 genes model)

model90allcdr1k99 = as.data.frame(y_test_90_cdr1k99)
model90allcdr1k99$predictor = predicciones_test_90_cdr1k99
model90allcdr1k99$model = "90 genes clinical AD (AUC = 0.94)"


names(model90allcdr1k99) = c("status", "predictor", "Classifier")


model90allcdr1k99 = model90allcdr1k99[model90allcdr1k99$status == 1,]



model90allcdr1k99 = rbind(model90allcdr1k99,controlsforspe)

model90allcdr1k99$Classifier = "90 genes clinical AD (AUC = 0.94)"
    
```




### AD CDR 1 EXPANSION values


Scale CDR 1 individuals

```{r}

genestodoml = genestodoml90

# Load Matrix
matrix_phase = readRDS("matrix_rlogk99qcADPreclinicalandControls_sex_agep_notion")
train = matrix_phase


# Select features
genestodoml = c(genestodoml, "Status")
commontrain = colnames(train) %in% genestodoml
train = train[,..commontrain]

# Select only genes
x_train <- train[,-1]




test = readRDS("rlogmatrix_allCDR1old38notion")

genestodoml = c(genestodoml, "Status")

test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <- test[,-1]


cdr1scalated = scaletwosets(x_train, x_test)



```




```{r}

test = readRDS("rlogmatrix_allCDR1old38notion")
test = subset(test, test$Status == "CA")


commontest = colnames(test) %in% genestodoml
test = test[,commontest]
 

# Select only genes
x_test <-cdr1scalated




x_testprueba = x_test[]-modelo_means[col(x_test[])]

x_testpruebafinal = x_testprueba[]/modelo_sd[col(x_testprueba[])]

x_test = x_testpruebafinal

x_test = as.data.frame(x_test)



# add gene name from cdr05
#x_test = cbind(x_test, setNames( lapply(genesnoaparecen, function(x) x=0), genesnoaparecen) )
x_test <- as.matrix(x_test )


clinictoeatmap = as.data.frame(x_test)

# Code status
numeros = as.numeric(test$Status)
 y_test <-replace(numeros, numeros == 2,0)


 y_test_cdr1exp = y_test


# Testing preditions
# ==============================================================================
predicciones_test <- predict(modelo, newx = x_test, type = "response" , standarize = F, intercept = F) 
 
 
 
  predicciones_test_cdr1exp = predicciones_test
 

 
 
model90cdr1exp = as.data.frame(y_test_cdr1exp)
model90cdr1exp$predictor = predicciones_test_cdr1exp
model90cdr1exp$model = "90 genes clinical AD (AUC = 0.94)"


names(model90cdr1exp) = c("status", "predictor", "Classifier")


model90allcdr1roc = rbind(model90allcdr1k99,model90cdr1exp)

```




### Figure roc ad conti


```{r}


model90adcontroc = rbind(model90rocadcontinuum, model90allcdr05roc)
 
model90adcontroc = rbind(model90adcontroc, model90allcdr1roc)
  

model90adcontroc$Classifier = as.factor(model90adcontroc$Classifier)
 
  model90adcontroc$Classifier <- factor(model90adcontroc$Classifier, levels = c("90 genes preclinical AD (AUC = 0.96)","90 genes prodromal AD (AUC = 0.95)","90 genes clinical AD (AUC = 0.94)"))
 

colors =c("#B2DF8A", "#9A031E", "#A1A7B8")
colors<-setNames(colors[1:nlevels(model90adcontroc$Classifier)], levels(model90adcontroc$Classifier))



## draw plots
basicplot <- ggplot(model90adcontroc, aes(d = status, m = predictor, color = Classifier)) + geom_roc(n.cuts = 0) +   style_roc(theme = theme_bw, xlab = "1-Specificity", ylab = "Sensitivity") + geom_abline(slope = 1, intercept = 0, lty = 2, colour = 'black') + 
    scale_colour_manual(values=colors) 

## calculate auc
# De aqui es de donde coges el AUC para cada uno
calc_auc(basicplot)

basicplot

  ggsave(filename = "roccurvesadcontinuum.png",
        plot = basicplot,
        device = "png",
        width =10,
        height = 8,
        dpi = 600)
 
```



## final AD figure continuum




```{r}

figadcontinuumroc = rbind(model90adcontroc,model40adcontroc)

figadcontinuumroc = rbind(figadcontinuumroc,model220adcontroc)

figadcontinuumroc$Classifier = as.factor(figadcontinuumroc$Classifier)
 
  figadcontinuumroc$Classifier <- factor(figadcontinuumroc$Classifier, levels = c("40 genes preclinical AD (AUC = 0.96)", "90 genes preclinical AD (AUC = 0.96)", "220 genes preclinical AD (AUC = 0.97)", "40 genes prodromal AD (AUC = 0.93)", "90 genes prodromal AD (AUC = 0.95)", "220 genes prodromal AD (AUC = 0.98)","40 genes clinical AD (AUC = 0.91)","90 genes clinical AD (AUC = 0.94)","220 genes clinical AD (AUC = 0.96)"))
 

colors =c( "#E31A1C", "#1F78B4", "#B2DF8A", "#FB9A99", "#6A3D9A", "#FDBF6F", "#B15928", "#E56024", "#0E2403")
colors<-setNames(colors[1:nlevels(figadcontinuumroc$Classifier)], levels(figadcontinuumroc$Classifier))



## draw plots
basicplot <- ggplot(figadcontinuumroc, aes(d = status, m = predictor, color = Classifier)) + geom_roc(n.cuts = 0) +   style_roc(theme = theme_bw, xlab = "1-Specificity", ylab = "Sensitivity") + geom_abline(slope = 1, intercept = 0, lty = 2, colour = 'black') + 
    scale_colour_manual(values=colors) 

## calculate auc
# De aqui es de donde coges el AUC para cada uno
calc_auc(basicplot)

basicplot

  ggsave(filename = "roccurvesadcontinuum.png",
        plot = basicplot,
        device = "png",
        width =10,
        height = 8,
        dpi = 600)
  
  
  
  # Preclinical AD 40
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "40 genes preclinical AD (AUC = 0.96)",]
  
  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))
  

  # Preclinical AD 90
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "90 genes preclinical AD (AUC = 0.96)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))
  

  # Preclinical AD 220
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "220 genes preclinical AD (AUC = 0.97)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))



  # prodromal AD 40
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "40 genes prodromal AD (AUC = 0.93)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))


  # prodromal AD 90
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "90 genes prodromal AD (AUC = 0.95)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))


  # prodromal AD 220
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "220 genes prodromal AD (AUC = 0.98)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))






  # clinical AD 40
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "40 genes clinical AD (AUC = 0.91)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))


  # clinical AD 90
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "90 genes clinical AD (AUC = 0.94)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))


  # clinical AD 220
  
  preadconfusion = figadcontinuumroc[figadcontinuumroc$Classifier == "220 genes clinical AD (AUC = 0.96)",]

  
caret::confusionMatrix(data = factor(as.numeric(preadconfusion$predictor>0.5)), reference = factor(preadconfusion$status))
  
 
```



